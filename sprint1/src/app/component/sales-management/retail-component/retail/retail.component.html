<!--khung tìm kiếm toa thuốc-->
  <div class="container mx-auto">
    <div class="mx-auto shadow-lg p-3 mb-1 bg-white rounded-lg row d-flex justify-content-center">
      <div class="col-4 px-0">
        <div class="form-group row">
          <label for="abc" class="col-5 col-form-label px-0 ml-2" style="max-width: 25%">Số phiếu<span class="text-danger">(*)</span>:</label>
          <div class="col-7 px-0">
            <input type="text" class="form-control form-control-sm" id="abc" placeholder="HDL0001" [readOnly]="disableFlag">
          </div>
        </div>
        <div class="form-group row">
          <label for="c" class="col-5 col-form-label px-0 ml-2" style="max-width: 25%">Nhân viên<span class="text-danger">(*)</span>:</label>
          <div class="col-7 px-0">
            <input type="text" class="form-control form-control-sm " id="c" placeholder="Nguyễn Văn A"  [readOnly]="disableFlag">
          </div>
        </div>
        <div class="form-group row">
          <label for="e" class="col-5 col-form-label w-50 px-0 ml-2" style="max-width: 25%">Ngày tạo<span class="text-danger">(*)</span>:</label>
          <div class="col-7 px-0">
            <input type="text" class="form-control form-control-sm" id="e" step="any" value="{{localDateTime | date : 'dd/MM/yyyy'}}" [readOnly]="disableFlag">
          </div>
        </div>
      </div>
      <div class="col-4 px-0 ">
        <div class="form-group row">
          <label for="kh" class="col-5 col-form-label w-50 px-0" style="max-width: 25%">Khách hàng<span class="text-danger">(*)</span>:</label>
          <div class="col-7 px-0">
            <input type="text" class="form-control form-control-sm" id="kh" placeholder="Khách lẻ" [readOnly]="disableFlag">
          </div>
        </div>
        <div class="form-group row">
          <label for="note" class="col-5 col-form-label px-0" style="max-width: 25%">Ghi chú</label>
          <div class="col-7 px-0">
            <textarea class="form-control form-control-sm" rows="3" id="note" [(ngModel)]="note"></textarea>
          </div>
        </div>
      </div>
      <div class="col-4 px-0 pl-3 ">
        <div class="form-group row">
          <label for="medicineSales" class="col-5 col-form-label px-0" style="max-width: 25%">Toa có sẵn</label>
          <div class="col-5 px-0 mx-0">
            <input list="medicineSales" value="" class="col-sm-10 form-control px-0  text-center mx-0"
                   style="max-width: 100%">

          </div>
          <div class="col-sm-2 px-0 mx-0">
            <button class="btn btn-primary">
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
          </div>
        </div>
        <div class="form-group row">
          <div class="col-3"></div>
          <div class="col-9 px-0">
            <button class="btn btn-light item-center" [routerLink]="['/sales-management/available-prescription']">
              <i class="fa-solid fa-file-lines"></i>
              Nhập thuốc từ toa
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
  <div class="container mx-auto">
    <div class="mx-auto shadow-lg p-3 mb-5 bg-white rounded-lg">
      <div>
        <h5>Danh sách thuốc<span class="text-danger">(*)</span>:</h5>
      </div>

      <table class="table table-hover">
        <thead >

        </thead>
        <tbody [formGroup]="invoiceForm">
        <tr>
              <td></td>
              <td class="col-3 text-center">
                <select id="medicineSales"
                        class="form-control text-center"
                        name="medicineSales"
                        formControlName="medicineSale" (click)="changeIsDisabled()">
                  <option [ngValue]="item" *ngFor="let item of medicineSales;">
                    {{item.medicineName}}
                  </option>
                </select>
              </td>
              <td class="col-2 text-center">
                <input type="number" class="form-control text-center"
                       formControlName="quantity" (click)="changeIsDisabled()">
              </td>
              <td class="col-2 text-center">
                <select class="form-control mx-auto text-center "
                        formControlName="unit" (click)="changeIsDisabled()">
                  <option [value]="'vien'"> Viên</option>
                  <option [value]="'vi'"> Vỉ</option>
                  <option [value]="'hop'"> Hộp</option>
                </select>
              </td>
              <td class="col-2 text-right" colspan="3">
                <button class="btn btn-success" (click)="addListMedicine()" [disabled]="isDisabled" >
                  <i class="fa-solid fa-circle-plus"></i>
                  Thêm thuốc
                </button>
              </td>
        </tr>
        <tr class="table-success">
          <th class="col-1 text-center">STT</th>
          <th class="col-2 text-center">Tên thuốc</th>
          <th class="col-2 text-center">Số lượng</th>
          <th class="col-2 text-center">Đơn vị</th>
          <th class="col-2 text-center">Giá</th>
          <th class="col-3 text-center">Thành tiền</th>
        </tr>
        <tr *ngFor="let item of listMedicineChoice; index as i;  let k = index"
            (click)="activeProject(k,item)"
            [ngStyle]="{'background-color': activeProjectIndex == k && flagHover ? '#9deba7' : 'white' }">
          <td class="col-1 text-center">{{i+1}}</td>
          <td class="col-2 text-center">{{item.medicineName}}</td>
          <td class="col-2 text-center">{{item.quantity}}</td>
          <td class="col-2 text-center">{{item.unit}}</td>
          <td class="col-2 text-center">
            {{item.retailPrice | currency :'VND': 'symbol'}}
          </td>
          <td class="col-3 text-center">
            {{item.money | currency :'VND':'symbol'}}
          </td>
        </tr>
        </tbody>
      </table>

      <div class="d-flex justify-content-end">
        <label for="tongtien" class="p-2 col-form-label"><strong>TỔNG TIỀN:</strong></label>
        <input id="tongtien" class="p-2 text-center form-control-sm" type="text"
               value="{{totalMoney|currency :'VND' :'symbol'}}"
               readonly>
      </div>
      <div class="d-flex justify-content-end">
        <div class="px-1">
          <button class="btn btn-success " (click)="createRetailInvoice()">
            <i class="fa-solid fa-circle-plus"></i>
            Thanh toán
          </button>
        </div>
        <div class="px-1">
          <button class="btn btn-danger " data-target="#deleteModal"
                  data-toggle="modal">
            <i class="fa-solid fa-circle-xmark"></i>
            Xoá thuốc
          </button>
        </div>
        <div class="px-1">
          <button class="btn btn-info ">
            <i class="fa-solid fa-print"></i>
            In phiếu
          </button>
        </div>
        <div class="pl-1">
          <button class="btn btn-secondary ">
            <i class="fa fa-undo" aria-hidden="true"></i>
            Trở về
          </button>
        </div>
      </div>
    </div>
  </div>
<!--==================================-->
<!--success modal-->
<div id="modal-success" class="modal fade">
  <div class="modal-dialog modal-confirm modal-confirm-success">
    <div class="modal-content">
      <div class="modal-header modal-header-success justify-content-center">
        <div class="icon-box">
          <i class="material-icons">&#xE876;</i>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body text-center">
        <h4>Thông Báo!</h4>
        <p>Tạo đơn bán hàng thành công.</p>
        <button #closeModalBtn type="button" class="btn-modal btn-grad-blue" data-dismiss="modal">Đồng ý</button>
      </div>
    </div>
  </div>
</div>
<!--modal success-->
<!--modal delete-->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Xác nhận xóa</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Bạn có muốn xóa thuốc này? (Tên thuốc:
          <span class="text-danger font-weight-bold" id="nameDelete">{{nameDelete}}</span>
          )
        </p>
      </div>
      <div class="modal-footer">
        <div class="mx-auto row">
          <input type="hidden" name="id" id="idDelete">
          <button #closeModal type="button" class="btn btn-secondary mx-1" data-dismiss="modal">Hủy</button>
          <button type="submit" class="btn btn-danger mx-1" (click)="deleteMedicine(closeModal)">Xóa</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!--modal delete-->
